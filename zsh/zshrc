# Initialize zsh completion system
autoload -Uz compinit
compinit

# Activate zsh-completions from brew package
if type brew &>/dev/null; then
  FPATH=$(brew --prefix)/share/zsh-completions:$FPATH

  autoload -Uz compinit
  compinit
fi

# Source Git's bash completion script for __git_ps1
source "$(brew --prefix git)/etc/bash_completion.d/git-prompt.sh"

# Enable prompt substitution
setopt PROMPT_SUBST

# PS1
# Function to count uncommitted changes (returns empty if none)
git_dirty_count() {
  if git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
    local count=$(git status --porcelain 2>/dev/null | wc -l | xargs)
    [ "$count" -gt 0 ] && echo "Â±$count"
  fi
}

# Set prompt with Git branch and uncommitted changes count
PS1='%F{red}%~ %F{green}$(__git_ps1 "git:(%s)$(git_dirty_count)")%f
'

# ELIXIR CONFIGS
export ERL_AFLAGS="-kernel shell_history enabled"
# Enable compiling docs into Erlang
export KERL_BUILD_DOCS=yes

export ELIXIR_EDITOR="zed://file/__FILE__:__LINE__"

export MIX_OS_DEPS_COMPILE_PARTITION_COUNT=$(( $(sysctl -n hw.physicalcpu) / 2 ))

# For Jumping to HEEx function definitions with PhoenixLiveReload to work
# export PLUG_EDITOR="vscode://file/__FILE__:__LINE__"
export PLUG_EDITOR="zed://file/__FILE__:__LINE__"

# Go
export PATH="$PATH:/Users/hugobarauna/go/bin"

# Set personal aliases, overriding those provided by oh-my-zsh libs,
# plugins, and themes. Aliases can be placed here, though oh-my-zsh
# users are encouraged to define aliases within the ZSH_CUSTOM folder.
# For a full list of active aliases, run `alias`.
#
# Example aliases
# alias zshconfig="mate ~/.zshrc"
# alias ohmyzsh="mate ~/.oh-my-zsh"

# ALIASES
# Git
alias gp="git pull"
alias gco="git checkout"
alias gst="git status"
alias gad="git add"
alias gci="git commit"
alias gdf="git diff | delta"
alias gdw="git diff --word-diff | delta"
alias gdc="git diff --cached | delta"
alias gtl="git timelog"
alias lg="lazygit"

# Directories
alias src="cd ~/src"
alias dt="cd ~/.dotfiles"
alias dotfiles="zed ~/.dotfiles"
alias brewfile="cd ~/.homebrew-brewfile"
alias nb="cd ~/src/notebooks"
alias re="cd ~/src/redar"

# Livebook
alias lb="cd ~/src/livebook"
alias tm="cd ~/src/teams"
alias lbserver="\
  MIX_ENV=prod \
  LIVEBOOK_LOG_LEVEL=debug \
  LIVEBOOK_DATA_PATH=~/src/tmp/livebook_data \
  LIVEBOOK_APPS_PATH=/Users/hugobarauna/src/tmp/notebooks/apps \
  LIVEBOOK_TOKEN_ENABLED=false \
  mix phx.server"
alias lbserver_with_fly_configs="\
  ERL_AFLAGS='-proto_dist inet6_tcp' \
  LIVEBOOK_NODE=livebook@::1 \
  MIX_ENV=prod \
  LIVEBOOK_LOG_LEVEL=debug \
  LIVEBOOK_DATA_PATH=~/src/tmp/livebook_data \
  LIVEBOOK_TOKEN_ENABLED=false \
  mix phx.server"
alias lb_with_local_teams="\
  LIVEBOOK_TEAMS_URL=http://localhost:4100 \
  LIVEBOOK_DATA_PATH=/Users/hugobarauna/src/tmp/livebook_data_paths/test/prod-livebook \
  LIVEBOOK_TOKEN_ENABLED=false \
  LIVEBOOK_LOG_LEVEL=debug \
  mix phx.server"

# Tidewave
alias ts="cd ~/src/ts"

# Elixir Radar
alias er="cd ~/src/elixir_radar_utils"

# Elixir
alias mps="mix phx.server"
alias pmps="MIX_ENV=prod mix phx.server"
alias mdg="mix deps.get"

# Misc
alias gt="ghostty"
alias ccc="npx ccusage@latest" # claude code costs

source ~/bin/functions.zsh
export PATH="$HOME/bin:$PATH"

# The next line updates PATH for the Google Cloud SDK.
if [ -f '/Users/hugobarauna/Downloads/google-cloud-sdk/path.zsh.inc' ]; then . '/Users/hugobarauna/Downloads/google-cloud-sdk/path.zsh.inc'; fi

# The next line enables shell command completion for gcloud.
if [ -f '/Users/hugobarauna/Downloads/google-cloud-sdk/completion.zsh.inc' ]; then . '/Users/hugobarauna/Downloads/google-cloud-sdk/completion.zsh.inc'; fi

export PATH="/opt/homebrew/bin:$PATH"

# . /opt/homebrew/opt/asdf/libexec/asdf.sh
export ASDF_DATA_DIR="/Users/hugobarauna/.asdf"
export PATH="$ASDF_DATA_DIR/shims:$PATH"

. "$HOME/.cargo/env"
export PATH="/opt/homebrew/opt/postgresql@16/bin:$PATH"

# Livebook
export LIVEBOOK_NODE="livebook@127.0.0.1"
export LIVEBOOK_COOKIE="secret"


eval "$(_MARIMO_COMPLETE=zsh_source marimo)"

# bun completions
[ -s "/Users/hugobarauna/.oh-my-zsh/completions/_bun" ] && source "/Users/hugobarauna/.oh-my-zsh/completions/_bun"

# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"

eval "$(direnv hook zsh)"

# opencode
export PATH=/Users/hugobarauna/.opencode/bin:$PATH

# for claude code native
export PATH=/Users/hugobarauna/.local/bin:$PATH

. "$HOME/.atuin/bin/env"

eval "$(atuin init zsh --disable-up-arrow)"
